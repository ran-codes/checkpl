# checkpl v0.0.1 - Product Requirements Document

## Overview

**Package name:** checkpl
**Version:** 0.0.1
**Inspiration:** R's [assertr](https://github.com/tonyfischetti/assertr) package

A lightweight, chainable data validation library for Polars DataFrames. Focuses on inline, ad-hoc validation that pipes naturally into Polars workflows.

---

## Scope for v0.0.1

Minimal viable package with 3 core functions:

| Function | Purpose |
|----------|---------|
| `verify(expr)` | Check that a Polars expression is true for all rows |
| `is_uniq(*cols)` | Check that column(s) have no duplicate combinations |
| `not_null(*cols)` | Check that column(s) have no null values |

Plus one custom exception:
| Class | Purpose |
|-------|---------|
| `CheckError` | Raised when any validation fails |

---

## Design Decisions

### API Style
**Direct functions** (not wrapped in `assert_that`):
```python
(
    df
    .pipe(verify(pl.col('x') > 0))
    .pipe(is_uniq('city_id', 'year'))
    .pipe(not_null('population'))
)
```

### Error Behavior
- **Raise immediately** on first failure
- No chain mode for v0.0.1 (can add later)

### Error Messages
- **Minimal** for v0.0.1: just report violation counts
- Example: `"is_uniq failed: 3 duplicate(s) in ['city_id', 'year']"`

### DataFrame Support
- Both **eager DataFrame** and **LazyFrame** supported
- Functions return the same type they receive (for chaining)

### Naming Convention
- Match **Polars conventions** (e.g., `not_null` not `not_na`)

### Exception Design
- Custom `CheckError` exception
- Has `check_name` attribute to identify which check failed
- Users can catch specifically: `except CheckError`

---

## Technical Requirements

| Requirement | Value |
|-------------|-------|
| Python version | >= 3.10 |
| Polars version | >= 1.0 |
| Other dependencies | None |

---

## Project Structure

```
checkpl/
├── src/
│   └── checkpl/
│       ├── __init__.py      # Public exports
│       ├── checks.py        # verify, is_uniq, not_null
│       └── errors.py        # CheckError exception
├── tests/
│   ├── __init__.py
│   └── test_checks.py
├── pyproject.toml
└── README.md
```

---

## Tooling

| Tool | Purpose |
|------|---------|
| uv | Dependency/environment management |
| pytest | Testing |
| ruff | Linting |
| hatchling | Build backend |

---

## Function Specifications

### `verify(expr: pl.Expr)`

Check that a Polars expression evaluates to `True` for all rows.

```python
# Usage
df.pipe(verify(pl.col('price') > 0))
df.pipe(verify(pl.col('status').is_in(['A', 'B'])))

# On failure
CheckError: "verify failed: 5 row(s) did not satisfy condition"
```

### `is_uniq(*cols: str)`

Check that column(s) contain only unique value combinations.

```python
# Single column
df.pipe(is_uniq('id'))

# Composite key
df.pipe(is_uniq('city_id', 'year'))

# On failure
CheckError: "is_uniq failed: 3 duplicate(s) in ['city_id', 'year']"
```

### `not_null(*cols: str)`

Check that column(s) contain no null values.

```python
# Single column
df.pipe(not_null('name'))

# Multiple columns
df.pipe(not_null('name', 'email', 'phone'))

# On failure
CheckError: "not_null failed: 2 null(s) in column 'email'"
```

---

## Test Requirements

### Test Cases per Function

**verify:**
- Passes when all rows satisfy expression
- Fails when any row is False
- Works with LazyFrame

**is_uniq:**
- Passes with unique values
- Fails with duplicates
- Works with single column
- Works with multiple columns (composite key)
- Raises ValueError if no columns provided

**not_null:**
- Passes with no nulls
- Fails with nulls (reports correct count)
- Works with multiple columns (checks each)
- Raises ValueError if no columns provided

**Chaining:**
- Multiple checks can be piped together
- Stops at first failure

---

## Future Versions (Out of Scope for v0.0.1)

- `chain_start()` / `chain_end()` for collecting all errors
- `within_bounds(lower, upper)` predicate
- `in_set(values)` predicate
- Verbose error messages showing failing rows/values
- Warning mode (warn instead of raise)
- Logging integration

---

## Success Criteria for v0.0.1

1. All tests pass
2. `uv run pytest` works
3. Package can be imported: `from checkpl import verify, is_uniq, not_null`
4. Basic chaining works as shown in examples
5. Ruff linting passes
